@page "/"
@using app_blazor.Components.Shared
@using static app_blazor.Components.Shared.TaskCalendar

<h2 class="page-h2">Dashboard (Home)</h2>

<div class="stats-grid">
    <div class="stat-tile">
        <div class="stat-label">Number of survey instruments served to date</div>
        <div class="stat-value">0</div>
    </div>
    <div class="stat-tile">
        <div class="stat-label">Number of respondents sampled to date</div>
        <div class="stat-value">0</div>
    </div>
    <div class="stat-tile">
        <div class="stat-label">Number of responses to date</div>
        <div class="stat-value">0</div>
    </div>
    <div class="stat-tile">
        <div class="stat-label">Response rate to date</div>
        <div class="stat-value">0.0000%</div>
    </div>
    <div class="stat-tile">
        <div class="stat-label">Average customer experience</div>
        <div class="stat-value">Not available</div>
    </div>
</div>

<div class="grid-2">
    <section class="panel">
        <div class="panel-title">My Tasks</div>
        <table class="table-lite">
            <thead>
                <tr>
                    <th style="width: 45%">Task</th>
                    <th style="width: 25%">Survey</th>
                    <th style="width: 15%">Due Date</th>
                    <th style="width: 15%">Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var t in Tasks)
                {
                    <tr>
                        <td>@t.Task</td>
                        <td>@t.Survey</td>
                        <td>@t.DueDate.ToString("MMM d")</td>
                        <td><span class="pill @GetPill(t.Status)">@t.Status</span></td>
                    </tr>
                }
            </tbody>
        </table>
    </section>

    <section class="panel">
        <div class="panel-title">Upcoming Schedule / Calendar View</div>

        <TaskCalendar Events="CalendarEvents" @bind-View="CalendarView" />
    </section>
</div>

@code {
    private TaskCalendar.CalendarViewMode CalendarView = TaskCalendar.CalendarViewMode.Month;

    private record TaskRow(string Task, string Survey, DateTime DueDate, string Status);

    private List<TaskRow> Tasks = new()
    {
        new("Finalize survey iteration dates", "1001 Crop Yield", new DateTime(2026, 1, 26), "In progress"),
        new("Validate status master (pre-publish)", "1002 Ag Census Pilot", new DateTime(2026, 1, 18), "Blocked"),
        new("Review questionnaire link (instrument)", "1001 Crop Yield", new DateTime(2026, 1, 22), "Not started"),
        new("Resolve schedule conflict (overlap)", "1004 Dairy Inventory", new DateTime(2026, 1, 17), "Overdue"),
        new("Confirm CAWI mode dates", "1003 Farm Labor Study", new DateTime(2026, 1, 11), "In progress"),
    };

    private List<TaskCalendar.CalendarEvent> CalendarEvents =>
        Tasks.Select(t => new TaskCalendar.CalendarEvent
        {
            Date = t.DueDate,
            Title = $"{t.Survey} — {t.Task}"
        }).ToList();

    private string GetPill(string status) => status switch
    {
        "In progress" => "pill-progress",
        "Blocked" => "pill-blocked",
        "Not started" => "pill-notstarted",
        "Overdue" => "pill-overdue",
        _ => ""
    };
}
