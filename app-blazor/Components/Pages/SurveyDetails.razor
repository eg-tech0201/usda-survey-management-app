@page "/surveys/details/{SurveyId:int?}"

<h1>Survey Details</h1>

<ul class="nav nav-tabs mb-3">
    <li class="nav-item">
        <button class='nav-link @(ActiveTab == "Overview" ? "active" : "")' @onclick='@(() => SetTab("Overview"))'>Overview</button>
    </li>
    <li class="nav-item">
        <button class='nav-link @(ActiveTab == "Assignments" ? "active" : "")' @onclick='@(() => SetTab("Assignments"))'>Assignments</button>
    </li>
</ul>

@if (ActiveTab == "Overview")
{
    <div class="card mb-3">
        <div class="card-body">
            <div class="row">
                <div class="col-md-4"><strong>Survey ID:</strong> @SelectedSurvey.Id</div>
                <div class="col-md-8"><strong>Title:</strong> @SelectedSurvey.Title</div>
            </div>
            <div class="row mt-2">
                <div class="col-md-4"><strong>OMB:</strong> @SelectedSurvey.OmbNumber</div>
                <div class="col-md-4"><strong>Status:</strong> @SelectedSurvey.Status</div>
                <div class="col-md-4"><strong>Sample:</strong> @SelectedSurvey.SampleName</div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">Linked OMB Docket</div>
        <div class="card-body">
            <div class="row g-3 align-items-end">
                <div class="col-12 col-md-6">
                    <label class="form-label">Approved Dockets</label>
                    <select class="form-select" @bind="SelectedDocketId">
                        @foreach (var docket in ApprovedDockets)
                        {
                            <option value="@docket.DocketId">@docket.DocketId â€” @docket.Title</option>
                        }
                    </select>
                </div>
                <div class="col-12 col-md-3">
                    <label class="form-label">Status</label>
                    <div>
                        <span class="badge bg-success">Approved</span>
                    </div>
                </div>
                <div class="col-12 col-md-3">
                    <button class="btn btn-primary w-100" type="button">Save Association</button>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="card mb-3">
        <div class="card-header">Assignments</div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Name</th>
                            <th>Role</th>
                            <th>Notes</th>
                            <th>CAWI</th>
                            <th>CATI</th>
                            <th>CAPI</th>
                            <th>Paper</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var member in Assignments)
                        {
                            <tr>
                                <td>@member.Name</td>
                                <td>@member.Role</td>
                                <td>@member.Notes</td>
                                <td><input type="checkbox" checked="@member.Cawi" /></td>
                                <td><input type="checkbox" checked="@member.Cati" /></td>
                                <td><input type="checkbox" checked="@member.Capi" /></td>
                                <td><input type="checkbox" checked="@member.Paper" /></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">Tools Enabled</div>
        <div class="card-body">
            <div class="d-flex flex-wrap gap-3">
                @foreach (var tool in Tools)
                {
                    <label class="form-check-label">
                        <input type="checkbox" class="form-check-input me-1" checked="@tool.Enabled" />
                        @tool.Name
                    </label>
                }
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public int? SurveyId { get; set; }

    private record SurveyRow(int Id, string Title, string OmbNumber, string Status, string SampleName);
    private record DocketRow(string DocketId, string Title, string Status);
    private record AssignmentRow(string Name, string Role, string Notes, bool Cawi, bool Cati, bool Capi, bool Paper);
    private record ToolRow(string Name, bool Enabled);

    private string ActiveTab { get; set; } = "Overview";

    private readonly List<SurveyRow> Surveys = new()
    {
        new(1001, "Crop Yield Survey (CY-2026)", "0535-0123", "In progress", "CY-2026 Core Sample"),
        new(1002, "Agricultural Census Pilot (ACP)", "0535-0456", "Blocked", "ACP Pilot Frame"),
        new(1003, "Farm Labor Study (FLS)", "0535-0789", "In progress", "FLS 2026 Sample"),
        new(1004, "Dairy Inventory Survey (DIS)", "0535-0321", "Overdue", "DIS Monthly Frame")
    };

    private readonly List<DocketRow> Dockets = new()
    {
        new("OMB-2026-001", "Crop Yield Survey OMB Renewal", "Approved"),
        new("OMB-2026-099", "Irrigation & Water Use", "Approved"),
        new("OMB-2026-014", "Agricultural Census Pilot", "Pending")
    };

    private readonly List<AssignmentRow> Assignments = new()
    {
        new("A. Chen", "Survey Lead", "Primary lead", true, true, false, false),
        new("M. Lewis", "Coordinator", "Schedule updates", true, false, true, true),
        new("D. Khan", "Analyst", "Metadata review", true, true, false, false)
    };

    private readonly List<ToolRow> Tools = new()
    {
        new("CAPI", true),
        new("CATI", true),
        new("CAWI", true),
        new("Paper", false),
        new("Secure Transfer", true)
    };

    private string SelectedDocketId { get; set; } = "OMB-2026-001";

    private SurveyRow SelectedSurvey =>
        Surveys.FirstOrDefault(s => s.Id == SurveyId) ?? Surveys.First();

    private IEnumerable<DocketRow> ApprovedDockets =>
        Dockets.Where(d => d.Status.Equals("Approved", StringComparison.OrdinalIgnoreCase));

    private void SetTab(string tab) => ActiveTab = tab;
}
